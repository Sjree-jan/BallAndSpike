<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | BallVsSpike</title>
  </head>
  
  <body style="text-align: center; padding: 0; border: 0; margin: 0;">

    <!-- ‚úÖ Load TON Connect SDK Properly
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@2.0.0"></script> -->

    <canvas id="unity-canvas" width=960 height=600 tabindex="-1" style="width: 960px; height: 600px; background: #231F20"></canvas>
    
    <button id="connectTonWalletButton" onclick="connectTONWallet()">Connect TON Wallet</button>

    <style>
      #connectTonWalletButton {
          position: absolute;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          padding: 12px 20px;
          font-size: 18px;
          background-color: #0088cc;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
      }
    </style>
<script>
  function loadTONConnectSDK(callback) {
      console.log("üîπ Attempting to load TON Connect SDK...");

      // Check if the script is already loaded
      if (typeof TonConnect !== "undefined") {
          console.log("‚úÖ TON Connect SDK is already loaded.");
          callback();
          return;
      }

      let script = document.createElement("script");
      script.src = "https://cdn.jsdelivr.net/npm/@tonconnect/sdk@2.0.0";
      script.async = true; // Load the script asynchronously
      script.onload = function () {
          console.log("‚úÖ TON Connect SDK successfully loaded.");
          callback();
      };
      script.onerror = function () {
          console.error("‚ùå TON Connect SDK failed to load!");
          alert("Error: TON Connect SDK could not be loaded!");
      };

      document.body.appendChild(script);
  }

  // Load SDK before running any functions
  loadTONConnectSDK(function() {
      console.log("üîπ TON Connect SDK is now available.");
  });
</script>

<script>
  let tonConnect;

  async function connectTONWallet() {
      console.log("üîπ Checking if TON Connect SDK is available...");

      if (typeof TonConnect === "undefined") {
          console.error("‚ùå TON Connect SDK is NOT loaded!");
          alert("Error: TON Connect SDK is not loading!");
          return;
      }

      try {
          // ‚úÖ Initialize TON Connect
          tonConnect = new TonConnect({ manifestUrl: 'https://ton.org/tonconnect-manifest.json' });
          console.log("‚úÖ TON Connect initialized", tonConnect);

          // ‚úÖ Get available wallets
          const wallets = await tonConnect.getWallets();
          console.log("üü¢ Available wallets:", wallets);

          if (wallets.length === 0) {
              alert("No TON wallets found. Install a TON wallet.");
              return;
          }

          // ‚úÖ Request wallet connection
          await tonConnect.connectWallet(wallets[0]);
          alert("‚úÖ Wallet connected successfully!");

          // ‚úÖ Get and display user's wallet address
          const userAddress = await tonConnect.getAddress();
          console.log("üè¶ User's Wallet Address:", userAddress);
          alert("Your Wallet Address: " + userAddress);

      } catch (error) {
          console.error("‚ùå Error connecting wallet:", error);
          alert("Error: " + error.message);
      }
  }
</script>


    <script src="Build/Game.loader.js"></script>

    <script>
      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        var meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.getElementsByTagName('head')[0].appendChild(meta);

        var canvas = document.querySelector("#unity-canvas");
        canvas.style.width = "100%";
        canvas.style.height = "100%";
        canvas.style.position = "fixed";

        document.body.style.textAlign = "left";
      }

      createUnityInstance(document.querySelector("#unity-canvas"), {
        dataUrl: "Build/Game.data",
        frameworkUrl: "Build/Game.framework.js",
        codeUrl: "Build/Game.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "BallVsSpike",
        productVersion: "1.0",
      });
    </script>

    <script>
      async function sendTONPayment() {
          try {
              if (!tonConnect) {
                  alert("Please connect a TON wallet first.");
                  return;
              }

              // Set transaction details
              const transaction = {
                  to: "UQAok7FgjcsELOZW8VXEp_XGdg8sGprewxDzro7XvClatVaH",  // Replace with your TON wallet address
                  value: "0.1",  // Amount in TON (e.g., 0.1 TON)
                  message: "Payment for game rewards"
              };

              // Send transaction
              const result = await tonConnect.sendTransaction(transaction);
              console.log("Transaction successful:", result);
              alert("Payment successful!");

          } catch (error) {
              console.error("Transaction failed:", error);
              alert("Payment failed!");
          }
      }
    </script>

    <button onclick="sendTONPayment()">Pay 0.1 TON</button>

  </body>
</html>
